---
tags:
  - ë°ì´í„°ë² ì´ìŠ¤
ê°•ì˜ëª…: ë°±ë°œë°±ì¤‘ ì‹œë¦¬ì¦ˆ - ë°ì´í„°ë² ì´ìŠ¤
ê°•ì˜_ë§í¬: https://www.youtube.com/watch?v=I1jjR58Rzic&list=PLcXyemr8ZeoREWGhhZi5FZs6cvymjIBVe&index=11
---
### Stored Procedure

- ì‚¬ìš©ìê°€ ì •ì˜í•œ í”„ë¡œì‹œì €
- RDBMSì— ì €ì¥ë˜ê³  ì‚¬ìš©ë˜ëŠ” í”„ë¡œì‹œì €
- êµ¬ì²´ì ì¸ í•˜ë‚˜ì˜ task ë¥¼ ìˆ˜í–‰í•œë‹¤

```sql
delimiter $$

CREATE PROCEDURE product(IN a int, IN b int,OUT result int)
BEGIN
	SET result = a * b;
END
$$

delimiter ;

```

Input, Output ëª…ì‹œ ( Input ì´ Default, Outputì€ ë°˜ë“œì‹œ ëª…ì‹œí•´ì¤˜ì•¼í•¨ )

```sql
call product(5,7,@result);
select @result;
```
`@result` ëŠ” 35ë¡œ ë‚˜ì˜¨ë‹¤.

```sql
delimiter $$

CREATE PROCEDURE swap(INOUT a int,INOUT b int)
	BEGIN
		set @temp = a;
		set a = b;
		set b = @temp;
	END
$$

delimiter ;
```

```sql
set @a = 5, @b = 7;
call swap(@a, @b);
select @a, @b;
```

ê° ë¶€ì„œë³„ í‰ê·  ì—°ë´‰ì„ ê°€ì ¸ì˜¤ì
```sql
delimiter $$

CREATE PROCEDURE get_dept_avg_salary()
BEGIN
	select dept_id,avg(salary)
	from employee
	group by dept_id;
END
$$

delimiter ;
```

ì‚¬ìš©ìê°€ í”„ë¡œí•„ ë‹‰ë„¤ì„ì„ ë°”ê¾¸ë©´, ì´ì „ ë‹‰ë„¤ì„ì„ ë¡œê·¸ì— ì €ì¥í•˜ê³  ìƒˆ ë‹‰ë„¤ì„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•˜ëŠ” í”„ë¡œì‹œì €ë¥¼ ì‘ì„±í•˜ì
```sql
delimiter $$
CREATE PROCEDURE change_nickname(user_id INT, new_nick varchar(30))
BEGIN
    insert into nickname_logs (
        select id, nickname, now() from users where id = user_id
    );
    update users set nickname = new_nick where id = user_id;
END
$$
delimiter ;
```

logs table ì— ê¸°ì¡´ì˜ ê°’ì„ ì €ì¥
### Stored Procedure VS Stored Function

ìƒê°ë³´ë‹¤ ë§¤ìš° ë‹¤ë¥´ë‹¤!

| **í•­ëª©**                               | **Stored Procedure**                   | **Stored Function**                         |
| ------------------------------------ | -------------------------------------- | ------------------------------------------- |
| **ìƒì„± ë¬¸ë²•**                            | CREATE PROCEDURE ...                   | CREATE FUNCTION ...                         |
| **return í‚¤ì›Œë“œë¡œ ê°’ ë°˜í™˜**                 | ë¶ˆê°€ëŠ¥<br>(SQL serverëŠ” ìƒíƒœì½”ë“œ ë°˜í™˜ìš©ìœ¼ë¡œëŠ” ì‚¬ìš© ê°€ëŠ¥) | ê°€ëŠ¥<br>(MySQL, SQL serverëŠ” ê°’ ë°˜í™˜í•˜ë ¤ë©´ í•„ìˆ˜)       |
| **íŒŒë¼ë¯¸í„°ë¡œ ê°’(ë“¤) ë°˜í™˜**                    | ê°€ëŠ¥<br>(ê°’(ë“¤)ì„ ë°˜í™˜í•˜ë ¤ë©´ í•„ìˆ˜)                 | ì¼ë¶€ ê°€ëŠ¥<br>(Oracle ê°€ëŠ¥í•˜ë‚˜ ê¶Œì¥ ì•ˆí•¨, PostgreSQL ê°€ëŠ¥) |
| **ê°’ì„ ê¼­ ë°˜í™˜í•´ì•¼ í•˜ë‚˜?**                    | í•„ìˆ˜ ì•„ë‹˜                                  | í•„ìˆ˜                                          |
| **SQL statementì—ì„œ í˜¸ì¶œ**               | ë¶ˆê°€ëŠ¥                                    | ê°€ëŠ¥                                          |
| **transaction ì‚¬ìš©**                   | ê°€ëŠ¥                                     | ëŒ€ë¶€ë¶„ ë¶ˆê°€ëŠ¥<br>(Oracleì˜ ê²½ìš° ê°€ëŠ¥)                  |
| **ì£¼ëœ ì‚¬ìš© ëª©ì **                         | Business logic                         | Computation                                 |
| **ë‹¤ë¥¸ function/procedure í˜¸ì¶œ ê°€ëŠ¥ ì—¬ë¶€**   | ê°€ëŠ¥                                     | ê°€ëŠ¥                                          |
| **Resultset(= table) ë°˜í™˜ ê°€ëŠ¥ ì—¬ë¶€**      | ê°€ëŠ¥                                     | ë¶ˆê°€ëŠ¥                                        |
| **Precompiled execution plan ì‚¬ìš© ì—¬ë¶€** | ê°€ëŠ¥                                     | ê°€ëŠ¥                                          |
- Procedure ëŠ” CALLë¬¸ í˜¸ì¶œ
- Functionì€ ì¼ë°˜ì  SQL ë¬¸ ë‚´ í‘œí˜„
