---
tags:
  - 데이터베이스
강의명: 백발백중 시리즈 - 데이터베이스
강의_링크: https://www.youtube.com/watch?v=I1jjR58Rzic&list=PLcXyemr8ZeoREWGhhZi5FZs6cvymjIBVe&index=12
---
Stored Procedure 자체가 매우 애매하다
-> 비즈니스 로직을 위해 사용한다

### 장점
#### application에 transparent 하다

4개의 애플리케이션 - 하나의 DB 존재

애플리케이션 단 내 비즈니스 로직을 바꾸려면?
-> 애플리케이션 서버를 동시에 바꾸지 않고, 하나씩 바꿔야 함 ( 트래픽 감당을 위해 )

DB 단 내 비즈니스 로직을 바꾸려면?
-> 애플리케이션단은 호출을 보내고, 프로시저만 바꾸면 OK
#### network traffic 을 줄여 응답 속도 향상 가능하다

로직이
```java
public void logic(){
	select user info
	insert new coupon
	update to vip
}
```
와 같이 여러개의 DB 호출 로직이 되어 있다면?
-> DB와 여러번의 네트워크 연결이 발생한다

```sql
procedure logic(...){
	select user info
	insert new coupon
	update to vip
}
```
프로시저로 내부 로직이 되어 있다면?
-> DB와 한 번의 연결로 가능하다
#### 여러 서비스에서 재사용 가능하다
Spring 구현 서비스 A, Django 구현 서비스 B,Node.js 구현 서비스 C 가 있다면?
-> 프로시저에 만들어 호출 시 재구현 할 필요가 없다.
#### 민감한 정보 대한 접근 제한
비밀번호나 주민등록번호를 외부에서 접근하는 것을 제한한다.
-> 애플리케이션 단 유출, 네트워크 탈취 가능성

DB에 프로시저 호출만 해서 로직 수행 기대
### 단점
#### 유지 관리 보수 비용이 커진다
소스 코드 보다가, 프로시저 코드를 봐야함
버전 관리를 둘 다 해야함
#### DB 서버 추가는 간단한 작업이 아님

웹 애플리케이션이 프로시저를 호출하면?
-> 대부분의 경우 애플리케이션 서버가 더 많다.
-> 트래픽 증가에 따라 DB의 부하 증가 속도가 훨씬 빠르다.

=> DB 서버를 복제 or 추가하는건 쉬운 일이 아니다 ( 데이터 복사&일관성 유지, 로드 밸런서, 비용 문제... )

결국 애플리케이션 서버를 늘리는게 DB 서버 늘리는것보다 더 쉬우므로 이득이다.
#### 완벽한 transparent 가 아니다

프로시저의 이름을 바꾸고 싶으면?
-> 어차피 서비스내 호출하는 프로시저 이름을 바꿔야 한다. ( 서버 재배포 필요 )

프로시저내 로직 문제가 있다면?
-> 그 시간 동안 모든 트래픽은 100% 에러를 발생한다.
( 애플리케이션 단이였다면 독립적으로 에러 발생 )
#### 재사용 가능하다는 것이 양날의 검

하나의 애플리케이션 서버가 어마어마한 프로시저를 호출 시?
-> 다른 애플리케이션 역시도 DB에서 원하는 값 받지 못할 확률 존재

=> 앞단에 데이터 제공용 서버를 만들고 제공하자
( 많은 프로시저 호출 서버를 차단 가능 )

---
### 장점에 대한 점 반박

#### 애플리케이션 내 비즈니스 로직 성능 향상 가능

비즈니스 로직을 애플리케이션 서버단에 두어도
애초에 응답 속도는 향상 시킬 수 있다.

```java
public void logic(){
	select user info
	insert new coupon
	update to vip
}
```

insert 와 update 를 동시에 하면 OK ( 순차적일 필요가 없다면 )

```java
public int getPoint(int id){
	getFormCache(id);
	return point if not null;


	select A;
	select B if ...;

	setCache(id,point,60);
	return point;
}
```
앞 단에 캐시를 구현해서 DB 호출 부하 줄일 수 있음 ( 응답속도 향상 )
#### DB or 테이블 접근 막으면 개발 & CS 업무 신속함이 떨어진다

프로시저를 통해 간접적으로 접근한다 하더라도, 프로시저를 수정하면 접근 가능하다.

DB or 테이블 접근 막으면 결국 개발 or CS 업무 신속함이 떨어진다.

- 담당자 or 개발자에게만 DB & 테이블 권한 부여하자
- 민감한 정보는 암호화해서 저장하자
- 보안서약서 등 통해 경쟁적으로 보안 강화하자

---

이외에도 
procedure 는 복잡하고 유연한 코드 작성하기 어렵다.
오늘날 프로그래밍 언어는 훨씬 다양&강력 기능 제공
procedure 는 가독성이 떨어진다.
procedure 는 디버깅이 어렵다.
